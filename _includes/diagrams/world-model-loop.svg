<svg
  class="fp-diagram"
  viewBox="0 0 960 420"
  role="img"
  aria-labelledby="fp-wm-title fp-wm-desc"
  xmlns="http://www.w3.org/2000/svg"
>
  <title id="fp-wm-title">A world model as an inner loop</title>
  <desc id="fp-wm-desc">
    An outer world produces observations. An inner loop updates internal state, simulates consequences, and plans actions.
    Constraints can sit around the inner loop as guardrails.
  </desc>

  <defs>
    <filter id="fp-wm-shadow" x="-20%" y="-20%" width="140%" height="140%">
      <feDropShadow dx="0" dy="10" stdDeviation="12" flood-color="#0F172A" flood-opacity="0.10" />
    </filter>
    <marker id="fp-wm-arrow" markerWidth="12" markerHeight="12" refX="10" refY="6" orient="auto">
      <path d="M0,0 L12,6 L0,12 Z" fill="#3B82F6" fill-opacity="0.9" />
    </marker>
  </defs>

  <g filter="url(#fp-wm-shadow)">
    <rect x="40" y="60" width="880" height="300" rx="26" fill="#FFFFFF" stroke="#E2E8F0" />

    <text
      x="90"
      y="120"
      font-size="16"
      font-weight="900"
      fill="#1E293B"
      font-family="Atkinson Hyperlegible, system-ui, sans-serif"
    >
      World model loop
    </text>
    <text
      x="90"
      y="145"
      font-size="12"
      fill="#475569"
      font-family="Atkinson Hyperlegible, system-ui, sans-serif"
    >
      Update, simulate, plan, act; then observe again.
    </text>

    <!-- Outer world -->
    <rect x="90" y="190" width="220" height="140" rx="22" fill="rgba(15, 23, 42, 0.03)" stroke="rgba(15, 23, 42, 0.10)" />
    <text x="120" y="235" font-size="14" font-weight="900" fill="#1E293B" font-family="Atkinson Hyperlegible, system-ui, sans-serif">
      World
    </text>
    <text x="120" y="257" font-size="12" fill="#475569" font-family="Atkinson Hyperlegible, system-ui, sans-serif">
      physical reality
    </text>
    <text x="120" y="277" font-size="12" fill="#475569" font-family="Atkinson Hyperlegible, system-ui, sans-serif">
      environment, system
    </text>

    <!-- Agent boundary -->
    <rect
      x="350"
      y="180"
      width="540"
      height="160"
      rx="24"
      fill="rgba(59, 130, 246, 0.04)"
      stroke="rgba(59, 130, 246, 0.18)"
      stroke-dasharray="8 8"
    />
    <text x="370" y="210" font-size="12" font-weight="900" fill="#1E293B" font-family="Atkinson Hyperlegible, system-ui, sans-serif">
      Inside the agent (the part that can drift)
    </text>
    <text x="370" y="232" font-size="12" fill="#475569" font-family="Atkinson Hyperlegible, system-ui, sans-serif">
      internal state, model, planner
    </text>

    <!-- Inner boxes -->
    <g font-family="Atkinson Hyperlegible, system-ui, sans-serif">
      <rect x="370" y="250" width="150" height="70" rx="18" fill="#FFFFFF" stroke="rgba(15, 23, 42, 0.12)" />
      <text x="388" y="278" font-size="13" font-weight="900" fill="#1E293B">Internal state</text>
      <text x="388" y="298" font-size="12" fill="#475569">belief / memory</text>

      <rect x="545" y="250" width="160" height="70" rx="18" fill="#FFFFFF" stroke="rgba(15, 23, 42, 0.12)" />
      <text x="563" y="278" font-size="13" font-weight="900" fill="#1E293B">World model</text>
      <text x="563" y="298" font-size="12" fill="#475569">simulate “if…”</text>

      <rect x="730" y="250" width="140" height="70" rx="18" fill="#FFFFFF" stroke="rgba(15, 23, 42, 0.12)" />
      <text x="748" y="278" font-size="13" font-weight="900" fill="#1E293B">Planner</text>
      <text x="748" y="298" font-size="12" fill="#475569">choose action</text>
    </g>

    <!-- Arrows -->
    <path d="M310 225 H360" stroke="#3B82F6" stroke-width="3" marker-end="url(#fp-wm-arrow)" stroke-linecap="round" />
    <text x="318" y="212" font-size="12" fill="#475569" font-family="Atkinson Hyperlegible, system-ui, sans-serif">observe</text>

    <path d="M520 285 H540" stroke="#3B82F6" stroke-width="3" marker-end="url(#fp-wm-arrow)" stroke-linecap="round" />
    <path d="M705 285 H725" stroke="#3B82F6" stroke-width="3" marker-end="url(#fp-wm-arrow)" stroke-linecap="round" />

    <path d="M800 250 C820 220, 820 210, 310 210" stroke="#3B82F6" stroke-width="3" marker-end="url(#fp-wm-arrow)" fill="none" stroke-linecap="round" />
    <text x="725" y="205" font-size="12" fill="#475569" font-family="Atkinson Hyperlegible, system-ui, sans-serif">act</text>

    <!-- Guardrails label -->
    <rect x="370" y="190" width="170" height="28" rx="14" fill="rgba(249, 115, 22, 0.10)" stroke="rgba(249, 115, 22, 0.22)" />
    <text x="384" y="209" font-size="12" font-weight="900" fill="#7C2D12" font-family="Atkinson Hyperlegible, system-ui, sans-serif">
      invariants / constraints
    </text>
  </g>
</svg>
