<svg
  class="fp-diagram"
  viewBox="0 0 960 460"
  role="img"
  aria-labelledby="fp-canq-title fp-canq-desc"
  xmlns="http://www.w3.org/2000/svg"
>
  <title id="fp-canq-title">Canonicalization collapses equivalence classes</title>
  <desc id="fp-canq-desc">
    Many states can be equivalent under a symmetry or a notion of same meaning. A canonicalizer chooses one representative
    per equivalence class, letting search operate on the quotient space rather than repeating symmetric cases.
  </desc>

  <defs>
    <filter id="fp-canq-shadow" x="-20%" y="-20%" width="140%" height="140%">
      <feDropShadow dx="0" dy="10" stdDeviation="12" flood-color="#0F172A" flood-opacity="0.10" />
    </filter>
    <marker
      id="fp-canq-arrow"
      markerWidth="12"
      markerHeight="12"
      refX="10"
      refY="6"
      orient="auto"
    >
      <path d="M0,0 L12,6 L0,12 Z" fill="#3B82F6" fill-opacity="0.9" />
    </marker>
  </defs>

  <g filter="url(#fp-canq-shadow)">
    <rect x="60" y="60" width="840" height="340" rx="26" fill="#FFFFFF" stroke="#E2E8F0" />

    <text
      x="100"
      y="118"
      font-size="16"
      font-weight="900"
      fill="#1E293B"
      font-family="Atkinson Hyperlegible, system-ui, sans-serif"
    >
      Canonicalization as symmetry breaking
    </text>
    <text
      x="100"
      y="144"
      font-size="12"
      fill="#475569"
      font-family="Atkinson Hyperlegible, system-ui, sans-serif"
    >
      Collapse “same meaning” descriptions into one representative, then search only representatives.
    </text>

    <!-- Left panel: raw space X -->
    <rect
      x="100"
      y="170"
      width="360"
      height="200"
      rx="22"
      fill="rgba(59, 130, 246, 0.10)"
      stroke="rgba(59, 130, 246, 0.22)"
    />
    <text
      x="124"
      y="206"
      font-size="14"
      font-weight="900"
      fill="#1E293B"
      font-family="Atkinson Hyperlegible, system-ui, sans-serif"
    >
      Space X (many equivalent states)
    </text>
    <text
      x="124"
      y="230"
      font-size="12"
      fill="#475569"
      font-family="Atkinson Hyperlegible, system-ui, sans-serif"
    >
      Equivalence classes under “~”.
    </text>

    <!-- Right panel: canonical reps -->
    <rect
      x="500"
      y="170"
      width="360"
      height="200"
      rx="22"
      fill="rgba(15, 23, 42, 0.06)"
      stroke="rgba(15, 23, 42, 0.14)"
    />
    <text
      x="524"
      y="206"
      font-size="14"
      font-weight="900"
      fill="#1E293B"
      font-family="Atkinson Hyperlegible, system-ui, sans-serif"
    >
      Canonical reps can(X)
    </text>
    <text
      x="524"
      y="230"
      font-size="12"
      fill="#475569"
      font-family="Atkinson Hyperlegible, system-ui, sans-serif"
    >
      One representative per class.
    </text>

    <!-- Equivalence class A -->
    <g>
      <ellipse cx="190" cy="275" rx="72" ry="44" fill="none" stroke="rgba(15, 23, 42, 0.25)" stroke-width="2" stroke-dasharray="6 6" />
      <circle cx="160" cy="260" r="8" fill="rgba(15, 23, 42, 0.45)" />
      <circle cx="195" cy="248" r="8" fill="rgba(15, 23, 42, 0.45)" />
      <circle cx="220" cy="278" r="8" fill="rgba(15, 23, 42, 0.45)" />
      <circle cx="182" cy="300" r="8" fill="rgba(15, 23, 42, 0.45)" />
      <text x="190" y="328" font-size="12" fill="#475569" font-family="Atkinson Hyperlegible, system-ui, sans-serif" text-anchor="middle">class A</text>
    </g>

    <!-- Equivalence class B -->
    <g>
      <ellipse cx="350" cy="260" rx="66" ry="40" fill="none" stroke="rgba(15, 23, 42, 0.25)" stroke-width="2" stroke-dasharray="6 6" />
      <circle cx="320" cy="246" r="8" fill="rgba(15, 23, 42, 0.45)" />
      <circle cx="360" cy="240" r="8" fill="rgba(15, 23, 42, 0.45)" />
      <circle cx="378" cy="268" r="8" fill="rgba(15, 23, 42, 0.45)" />
      <text x="350" y="308" font-size="12" fill="#475569" font-family="Atkinson Hyperlegible, system-ui, sans-serif" text-anchor="middle">class B</text>
    </g>

    <!-- Equivalence class C -->
    <g>
      <ellipse cx="270" cy="336" rx="72" ry="40" fill="none" stroke="rgba(15, 23, 42, 0.25)" stroke-width="2" stroke-dasharray="6 6" />
      <circle cx="240" cy="326" r="8" fill="rgba(15, 23, 42, 0.45)" />
      <circle cx="270" cy="312" r="8" fill="rgba(15, 23, 42, 0.45)" />
      <circle cx="304" cy="330" r="8" fill="rgba(15, 23, 42, 0.45)" />
      <circle cx="272" cy="352" r="8" fill="rgba(15, 23, 42, 0.45)" />
      <text x="270" y="364" font-size="12" fill="#475569" font-family="Atkinson Hyperlegible, system-ui, sans-serif" text-anchor="middle">class C</text>
    </g>

    <!-- Canonical representatives -->
    <g>
      <circle cx="640" cy="262" r="11" fill="rgba(59, 130, 246, 0.85)" />
      <text x="640" y="296" font-size="12" fill="#475569" font-family="Atkinson Hyperlegible, system-ui, sans-serif" text-anchor="middle">rep A</text>

      <circle cx="772" cy="262" r="11" fill="rgba(59, 130, 246, 0.85)" />
      <text x="772" y="296" font-size="12" fill="#475569" font-family="Atkinson Hyperlegible, system-ui, sans-serif" text-anchor="middle">rep B</text>

      <circle cx="706" cy="336" r="11" fill="rgba(59, 130, 246, 0.85)" />
      <text x="706" y="370" font-size="12" fill="#475569" font-family="Atkinson Hyperlegible, system-ui, sans-serif" text-anchor="middle">rep C</text>
    </g>

    <!-- Arrows (can) -->
    <g stroke="#3B82F6" stroke-width="3" stroke-linecap="round" opacity="0.9" marker-end="url(#fp-canq-arrow)">
      <path d="M262 275 C370 275, 470 262, 622 262" />
      <path d="M416 260 C470 260, 520 262, 754 262" />
      <path d="M342 336 C420 336, 520 336, 688 336" />
    </g>
    <text
      x="480"
      y="252"
      font-size="12"
      fill="#1E293B"
      font-weight="900"
      font-family="Atkinson Hyperlegible, system-ui, sans-serif"
      text-anchor="middle"
    >
      can
    </text>

    <!-- Footer formulas -->
    <text
      x="480"
      y="392"
      font-size="12"
      fill="#475569"
      font-family="ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, Liberation Mono, Courier New, monospace"
      text-anchor="middle"
    >
      can(x) ~ x, and can(x) = can(y) ⇔ x ~ y
    </text>
  </g>
</svg>
